/**
 * Created by dinglei on 16/3/18.
 */
//VUE 依赖配置
var Vue = require('vue');
var VueRouter = require('vue-router');
Vue.use(VueRouter);
var VueAsyncData = require('vue-async-data');
Vue.use(VueAsyncData);
var App = Vue.extend(require('./app.vue'));

//$.ajaxSettings.crossDomain = true;

//防止点击穿透
var fastclick = require('fastclick');
fastclick.attach(document.body);

var router = new VueRouter({
    hashbang: true,  //为true的时候 example.com/#!/foo/bar ， false的时候 example.com/#/foo/bar
    //abstract:true,
    //地址栏不会有变化
    //以下设置需要服务端设置
    //history: false,   //当使用 HTML5 history 模式时，服务器需要被正确配置 以防用户在直接访问链接时会遇到404页面。
    //saveScrollPosition: false
    history: false,
    saveScrollPosition: true,
    transitionOnLoad: true,
    linkActiveClass:'nav-active' //全局设置连接匹配时的类名 参考http://vuejs.github.io/vue-router/en/link.html
});

//登录中间验证，页面需要登录而没有登录的情况直接跳转登录
router.beforeEach(function(transition) {
    //处理左侧滚动不影响右边
    //$("html, body, #page").removeClass("scroll-hide");
    if (transition.to.auth) {
        if (localStorage.userId) {
            transition.next();
        } else {
            var redirect = encodeURIComponent(transition.to.path);
            transition.redirect('/login?redirect=' + redirect);
        }
    } else {
        transition.next();
    }
});

require('./router')(router);

router.start(App,'#app');